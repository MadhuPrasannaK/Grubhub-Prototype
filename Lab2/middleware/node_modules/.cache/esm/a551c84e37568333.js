let express,passport,multerUploads,dataUri,cloudinaryConfig,handleUpload;_375‍.x([["default",()=>_375‍.o]]);_375‍.w("express",[["default",["express"],function(v){express=v}]]);_375‍.w("passport",[["default",["passport"],function(v){passport=v}]]);_375‍.w("../config/multer",[["multerUploads",["multerUploads"],function(v){multerUploads=v}],["dataUri",["dataUri"],function(v){dataUri=v}]]);_375‍.w("../config/cloudinary",[["cloudinaryConfig",["cloudinaryConfig"],function(v){cloudinaryConfig=v}]]);_375‍.w("../config/imageUploader",[["handleUpload",["handleUpload"],function(v){handleUpload=v}]]);













const kafka = require('../kafka/client');
const userRouter = express.Router();

userRouter.post('/login', passport.authenticate('login'), (req, res) => {
    console.log('Inside POST user login');
    _375‍.g.console.log('Request Body: ', req.body);
    const userCredentials = req.body;
    kafka.make_request("loginUser", userCredentials, (err, result) => {
        if (err) {
            _375‍.g.console.log("Error ", err);
            res.status(500).json({
                message: err.message
            })
        }
        res.status(200).json(result)
    });
});

userRouter.post('/register', passport.authenticate('register'), (req, res) => {
    console.log('Inside POST user register');
    _375‍.g.console.log('Request Body: ', req.body);
    kafka.make_request("registerUser", req.body, (err, result) => {
        if (err) {
            _375‍.g.console.log("Error ", err);
            res.status(500).json({
                message: err.message
            })
        }
        res.status(200).json(result)
    });
});

userRouter.get("/user/:user_id", (req, res) => {
    console.log('Inside GET user');
    kafka.make_request("getUser", req.params.user_id, (err, result) => {
        if (err) {
            _375‍.g.console.log("Error ", err);
            res.status(500).json({
                message: err.message
            })
        }
        res.status(200).json(result)
    });
});

userRouter.put("/userUpdate/:user_id", passport.authenticate("jwt"), (req, res) => {
    console.log('Inside PUT user update');
    _375‍.g.console.log('Request Body: ', req.body);

    const userDetails = req.body;
    userDetails.user_id = req.params.user_id;

    kafka.make_request("updateUser", userDetails, (err, result) => {
        if (err) {
            _375‍.g.console.log("Error ", err);
            res.status(500).json({
                message: err.message
            })
        }
        res.status(200).json(result)
    });
});

userRouter.post("/upload/image", multerUploads, cloudinaryConfig, (req, res) => {
    console.log('Inside POST user upload image');
    _375‍.g.console.log('Request Body: ', req.body);
    let file;
    if (req.file) {
        file = dataUri(req).content;
    } else {
        res.status(400).json({
            message: 'File not uploaded!'
        });
    }
    handleUpload(file).then(result => {
        res.status(200).json(result);
    }).catch(err => {
        res.status(500).json(err);
    });
});
_375‍.d(userRouter);